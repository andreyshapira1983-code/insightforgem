# ===== Build =====
[build]
  publish   = "."
  functions = "netlify/functions"

# Узлы сборки функций
[functions]
  node_bundler = "esbuild"
  external_node_modules = ["@netlify/blobs"]

# ===== Глобальные security-заголовки =====
[[headers]]
  for = "/*"
  [headers.values]
    Strict-Transport-Security = "max-age=63072000; includeSubDomains; preload"
    X-Content-Type-Options    = "nosniff"
    X-Frame-Options           = "SAMEORIGIN"
    Referrer-Policy           = "strict-origin-when-cross-origin"
    Permissions-Policy        = "accelerometer=(), ambient-light-sensor=(), autoplay=(), camera=(), display-capture=(), encrypted-media=(), fullscreen=*, geolocation=(), gyroscope=(), magnetometer=(), microphone=(), midi=(), payment=(), picture-in-picture=*, speaker=(), usb=(), vr=()"
    Cross-Origin-Resource-Policy = "same-site"
    X-Robots-Tag              = "all"

    # !!! CSP в режиме применения (не report-only)
    # НИЧЕГО с CDN не грузим — шрифты/иконки держим локально.
    # Разрешены только: свой домен, функции, Netlify API и изображения Unsplash.
    Content-Security-Policy = "default-src 'self'; script-src 'self'; style-src 'self'; img-src 'self' data: https://images.unsplash.com; font-src 'self'; connect-src 'self' https://api.netlify.com /.netlify/functions; frame-ancestors 'none'; base-uri 'self'; form-action 'self'; upgrade-insecure-requests"

# ===== Кеширование статики (1 год, immutable) =====
[[headers]]
  for = "/css/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/js/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/webfonts/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

[[headers]]
  for = "/vendor/*"
  [headers.values]
    Cache-Control = "public, max-age=31536000, immutable"

# HTML — без кеша (чтобы видеть обновления сразу)
[[headers]]
  for = "/*.html"
  [headers.values]
    Cache-Control = "no-cache, no-store, must-revalidate"

# Пример: редирект на главную для 404 (необязательно)
# [[redirects]]
#   from = "/*"
#   to   = "/index.html"
#   status = 200
