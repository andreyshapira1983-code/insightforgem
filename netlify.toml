# ===== БИЛД И ФУНКЦИИ =====
[build]
  publish   = "."                  # статика из корня репо (index.html и др.)
  functions = "netlify/functions"  # серверные функции здесь

  [build.environment]
    NODE_VERSION = "20"            # можно оставить как есть, 20-й LTS

[functions]
  node_bundler  = "esbuild"
  included_files = []              # при необходимости сюда добавим файлы

# ===== КРАСИВЫЕ URL ДЛЯ СТРАНИЦ =====
# /generator -> /generator.html
[[redirects]]
  from = "/generator"
  to   = "/generator.html"
  status = 200
  force  = true

# /community -> /community.html
[[redirects]]
  from = "/community"
  to   = "/community.html"
  status = 200
  force  = true

# /api/<name> -> /.netlify/functions/<name>
[[redirects]]
  from = "/api/:name"
  to   = "/.netlify/functions/:name"
  status = 200
  force  = true

# ===== БАЗОВЫЕ ЗАГОЛОВКИ БЕЗОПАСНОСТИ (НЕ ЛОМАЮТ, REPORT-ONLY) =====
[[headers]]
  for = "/*"
  [headers.values]
    # Пока только отчёт (ничего не блокирует). Когда всё ок — можно включить боевой CSP.
    Content-Security-Policy-Report-Only = "default-src 'self'; img-src 'self' data: https:; script-src 'self'; style-src 'self' 'unsafe-inline'; font-src 'self' data:; connect-src 'self'; frame-ancestors 'none'; base-uri 'self'; form-action 'self'"
    Strict-Transport-Security          = "max-age=31536000; includeSubDomains; preload"
    X-Frame-Options                    = "DENY"
    X-Content-Type-Options             = "nosniff"
    Referrer-Policy                    = "no-referrer"
    Permissions-Policy                 = "camera=(), microphone=(), geolocation=()"
    Cache-Control                       = "no-store"
    Cross-Origin-Opener-Policy         = "same-origin"
    Cross-Origin-Resource-Policy       = "same-origin"
    Cross-Origin-Embedder-Policy       = "require-corp"
