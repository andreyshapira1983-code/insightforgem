<!doctype html>
<html>
  <meta charset="utf-8">
  <title>Оценка идеи (EVAL)</title>
  <h1>Оценка идеи (EVAL)</h1>
  <textarea id="idea" rows="6" style="width:100%;" placeholder="Введи идею..."></textarea><br>
  <button id="go">Получить оценку</button>
  <p id="score">Оценка: —</p>
  <pre id="debug" style="background:#f7f7f7; padding:8px; white-space:pre-wrap;"></pre>

  <script>
    async function post(url, data){
      const r = await fetch(url, { method:'POST', headers:{'Content-Type':'application/json'}, body: JSON.stringify(data) });
      const text = await r.text();
      let json = null; try { json = JSON.parse(text); } catch(e) {}
      return { status:r.status, json, text };
    }
    document.getElementById('go').onclick = async () => {
      const idea = document.getElementById('idea').value.trim();
      if (!idea) { alert('Нужен текст идеи'); return; }
      document.getElementById('score').textContent = 'Оценка: считаю...';
      document.getElementById('debug').textContent = '';
      const res = await post('/.netlify/functions/score', { idea, brief:{}, historyTexts: [] });
      if (res.json && typeof res.json.score === 'number') {
        document.getElementById('score').textContent = `Оценка: ${res.json.score}%`;
      } else {
        document.getElementById('score').textContent = 'Оценка: не получена';
      }
      document.getElementById('debug').textContent =
        'HTTP ' + res.status + '\n' +
        (res.json ? JSON.stringify(res.json, null, 2) : res.text);
    };
  </script>
</html>
